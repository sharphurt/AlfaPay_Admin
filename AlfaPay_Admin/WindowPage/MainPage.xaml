<Page x:Class="AlfaPay_Admin.WindowPage.MainPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:fa="http://schemas.fontawesome.io/icons/"
      xmlns:customControl="clr-namespace:AlfaPay_Admin.CustomControl"
      mc:Ignorable="d"
      Title="MainPage"
      MinHeight="630"
      MinWidth="1200"
      ShowsNavigationUI="False"
      MouseDown="MainPage_OnMouseDown">
    <Grid>
        <Grid Margin="10" Focusable="True" x:Name="Grid">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="40 px" />
                <RowDefinition Height="*" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <Border CornerRadius="4" Grid.Column="0" Grid.Row="0" Grid.ColumnSpan="2" Background="#f3f4f5">
                <DockPanel Margin="2,2,0,2" VerticalAlignment="Center">
                    <WrapPanel DockPanel.Dock="Left" x:Name="SearchPanel" Orientation="Horizontal" Margin="15,0,0,0"
                               Background="Transparent"
                               VerticalAlignment="Center">
                        <Image Source="{DynamicResource SearchIcon}" x:Name="SearchIcon"
                               RenderOptions.BitmapScalingMode="HighQuality"
                               Stretch="UniformToFill" Width="14" Height="14" Opacity="0.3" />
                        <WrapPanel Orientation="Vertical" Margin="10,0,0,0">
                            <TextBox x:Name="SearchTextBox" Style="{DynamicResource SearchTextBoxStyle}"
                                     Margin="0,0,0,4"
                                     Text="Поиск по компаниям"
                                     VerticalContentAlignment="Center"
                                     GotFocus="SearchTextBox_OnGotFocus"
                                     LostFocus="SearchTextBox_OnLostFocus" />
                            <Line x:Name="LineUnderSearch" Width="250" StrokeThickness="1" Stroke="#B6BCC3" X1="0"
                                  Y1="0"
                                  X2="250" Y2="0" />
                        </WrapPanel>
                    </WrapPanel>
                    <Button DockPanel.Dock="Right" Width="32" Margin="10,0,15,0"
                            Style="{DynamicResource LogoutButtonStyle}">
                        <Image Source="{DynamicResource LogOutIcon}" RenderOptions.BitmapScalingMode="HighQuality"
                               Stretch="UniformToFill" Margin="2,0,0,0" Width="14" Height="14" />
                    </Button>
                    <Label DockPanel.Dock="Right" HorizontalAlignment="Right" Style="{DynamicResource PrimaryText}">Лукоянов Павел Валерьевич</Label>
                </DockPanel>
            </Border>
            <GroupBox Grid.Column="0" Grid.Row="1" Margin="0,0,5,5">
                <GroupBox.Header>
                    <Label Background="White" Style="{DynamicResource PrimaryHeader}" Padding="5,0,5,5"
                           Margin="0,5,0,0"
                           Content="Информация о клиенте" />
                </GroupBox.Header>
                <Grid>
                    <Image Source="{DynamicResource DeadImage}" Width="150" HorizontalAlignment="Center"
                           VerticalAlignment="Center" Style="{DynamicResource FadeInFadeOutEffectImage}"
                           Visibility="{Binding Error, Converter={StaticResource ObjectToVisibilityConverter}}" />
                    <Label HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Style="{DynamicResource FadeInFadeOutEffectControl}"
                           FontFamily="Segoe UI"
                           FontWeight="Light"
                           FontSize="20"
                           Opacity="0.5"
                           Visibility="{Binding ElementName=ApplicationsListBox, Path=Items.IsEmpty, Converter={StaticResource BoolToVisibilityConverter}}"
                           Content="Выберите заявку из списка" />

                    <WrapPanel IsEnabled="{Binding IsLoading}" HorizontalAlignment="Center" VerticalAlignment="Center"
                               Style="{DynamicResource FadeInFadeOutEffectPanel}">
                        <Label Style="{DynamicResource LightText}" Content="Дождитесь окончания загрузки данных" />
                        <fa:ImageAwesome Source="{DynamicResource SpinSmallIcon}" Margin="5,0,0,0" Spin="True" SpinDuration="0.8"
                                         Width="16" Height="16" />
                    </WrapPanel>
                    <Grid Margin="15,0,15,0" ZIndex="1" DataContext="{Binding SelectedApplication}"
                          Background="White"
                          Visibility="{Binding ElementName=ApplicationsListBox, Path=SelectedItem, Converter={StaticResource ObjectToVisibilityConverter}}"
                          Style="{DynamicResource FadeInFadeOutEffectPanel}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="150 px" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <Label Grid.Column="0" Grid.Row="0" HorizontalAlignment="Left"
                               Style="{DynamicResource SecondaryHeader}" Content="Имя" />
                        <Label Grid.Column="0" Grid.Row="1" HorizontalAlignment="Left"
                               Style="{DynamicResource SecondaryHeader}" Content="Email" />
                        <Label Grid.Column="0" Grid.Row="2" HorizontalAlignment="Left"
                               Style="{DynamicResource SecondaryHeader}" Content="Телефон" />
                        <Label Grid.Column="0" Grid.Row="3" HorizontalAlignment="Left"
                               Style="{DynamicResource SecondaryHeader}"
                               Content="ИНН компании" />
                        <Label Grid.Column="0" Grid.Row="4" HorizontalAlignment="Left"
                               Style="{DynamicResource SecondaryHeader}" Content="Дата подачи" />

                        <Label Grid.Column="1" Grid.Row="0" HorizontalAlignment="Right"
                               Style="{DynamicResource PrimaryText}" Content="{Binding Name}" />
                        <Label Grid.Column="1" Grid.Row="1" HorizontalAlignment="Right"
                               Style="{DynamicResource PrimaryText}" Content="{Binding Email}" />
                        <Label Grid.Column="1" Grid.Row="2" HorizontalAlignment="Right"
                               Style="{DynamicResource PrimaryText}" Content="{Binding Phone}" />
                        <Label Grid.Column="1" Grid.Row="3" HorizontalAlignment="Right"
                               Style="{DynamicResource PrimaryText}" Content="{Binding Inn}" />
                        <Label Grid.Column="1" Grid.Row="4" HorizontalAlignment="Right"
                               Style="{DynamicResource PrimaryText}"
                               Content="{Binding CreatedAt, Converter={StaticResource DateTimeConverter}}" />

                        <TextBlock Grid.Column="2" Margin="10,0,0,0" Grid.Row="3" HorizontalAlignment="Left"
                                   VerticalAlignment="Center">
                            <Hyperlink NavigateUri="">
                                Подробнее о компании
                            </Hyperlink>
                        </TextBlock>

                        <Label Grid.Column="2" Margin="10,0,0,0" Grid.Row="4" Style="{DynamicResource TertiaryText}"
                               Content="{Binding DaysPassed}" />
                    </Grid>
                </Grid>
            </GroupBox>

            <Grid Grid.Column="0" Row="2"
                  IsEnabled="{Binding ElementName=ApplicationsListBox, Path=SelectedItem, Converter={StaticResource ObjectToBoolConverter}}"
                  VerticalAlignment="Top" Margin="0,3,6,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0" Style="{StaticResource ButtonStyle}" Height="40 px" Margin="0,0,7,0">
                    <WrapPanel Orientation="Horizontal">
                        <Image Source="{StaticResource SendIcon}" RenderOptions.BitmapScalingMode="HighQuality"
                               Width="16"
                               Height="16" Margin="10,0,10,0" />
                        <Label FontFamily="Segoe UI" FontSize="16" Margin="0,0,0,3" Content="Связаться с клиентом" />
                    </WrapPanel>
                </Button>
                <Button x:Name="AcceptButton" Grid.Column="1" Style="{StaticResource ButtonStyle}" Height="40 px"
                        Margin="7,0,7,0" Click="AcceptButton_OnClick">
                    <WrapPanel Orientation="Horizontal">
                        <Image Source="{StaticResource TickIcon}" RenderOptions.BitmapScalingMode="HighQuality"
                               Width="16"
                               Height="16" Margin="10,0,10,0" />
                        <Label FontFamily="Segoe UI" FontSize="16" Margin="0,0,0,3">Одобрить заявку</Label>
                    </WrapPanel>
                </Button>
                <Button Grid.Column="2" Style="{StaticResource ButtonStyle}" Height="40 px" Margin="7,0,0,0">
                    <WrapPanel Orientation="Horizontal">
                        <Image Source="{StaticResource RejectIcon}" RenderOptions.BitmapScalingMode="HighQuality"
                               Width="14" Height="14" Margin="10,0,10,0" />
                        <Label FontFamily="Segoe UI" FontSize="16" Margin="0,0,0,3">Отклонить заявку</Label>
                    </WrapPanel>
                </Button>
            </Grid>
            <GroupBox Grid.Column="1" Grid.Row="1" Grid.RowSpan="2" Margin="0,0,5,5">
                <GroupBox.Header>
                    <Label Style="{DynamicResource PrimaryHeader}" Background="White" Padding="5,0,5,5"
                           Margin="0,5,0,0"
                           Content="Заявки на рассмотение" />
                </GroupBox.Header>
                <Grid>
                    <ListBox x:Name="ApplicationsListBox"
                             HorizontalContentAlignment="Stretch"
                             VerticalContentAlignment="Stretch"
                             BorderThickness="0"
                             ItemsSource="{Binding Applications, UpdateSourceTrigger=PropertyChanged}"
                             ScrollViewer.CanContentScroll="False"
                             SelectionChanged="ApplicationsListBox_OnSelectionChanged"
                             SelectedItem="{Binding SelectedApplication}">
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="ListBoxItem">
                                            <ContentPresenter />
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </ListBox.ItemContainerStyle>

                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Grid Height="50 px" Style="{DynamicResource ListBoxElement}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="5 px" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*" />
                                        <RowDefinition Height="*" />
                                    </Grid.RowDefinitions>

                                    <Line x:Name="SelectionLine" Grid.Column="0" Grid.Row="0" Grid.RowSpan="2" X1="0"
                                          X2="0"
                                          Y1="0" Y2="60" Stroke="#F15045" StrokeThickness="5"
                                          Visibility="Collapsed"
                                          Style="{DynamicResource FadeInFadeOutEffectShape}" />
                                    <Label Grid.Column="1" Grid.Row="0" Style="{DynamicResource SecondaryHeader}"
                                           Content="{Binding Path=Name}" Height="30" />
                                    <Label Grid.Column="1" Grid.Row="1" Style="{DynamicResource SecondaryText}"
                                           Content="{Binding Path=Phone}" />
                                    <Label Grid.Column="2" Grid.Row="0" Grid.RowSpan="2"
                                           Style="{DynamicResource TertiaryText}"
                                           Content="{Binding Path=CreatedAt}" HorizontalAlignment="Right"
                                           VerticalAlignment="Bottom" />
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    <WrapPanel Panel.ZIndex="1"
                               IsEnabled="{Binding ResponseReceived, Converter={StaticResource InvertedBoolConverter}}"
                               Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center"
                               Margin="0,0,0,30"
                               Style="{DynamicResource FadeInFadeOutEffectPanel}">
                        <fa:ImageAwesome Panel.ZIndex="1" Source="{DynamicResource SpinIcon}" SpinDuration="0.8"
                                         Spin="true" Height="40" Width="40" />
                        <Label Style="{DynamicResource LightText}" Content="Данные загружаются" Margin="0,7,0,40" />
                    </WrapPanel>
                    <WrapPanel Panel.ZIndex="1"
                               IsEnabled="{Binding Error, Converter={StaticResource ObjectToBoolConverter}}"
                               Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center"
                               Margin="0,0,0,30"
                               Style="{DynamicResource FadeInFadeOutEffectPanel}">
                        <fa:ImageAwesome Panel.ZIndex="1" Source="{DynamicResource ErrorIcon}"
                                         Height="40" Width="40" />
                        <Label Style="{DynamicResource LightText}" HorizontalAlignment="Center"
                               Content="Произошла ошибка"
                               Margin="0,7,0,0" />
                        <Button Content="Попробовать снова"
                                Style="{DynamicResource RefreshButtonStyle}" Margin="0,10,0,0"
                                Height="30" Width="150" Command="{Binding RefreshCommand}" />
                    </WrapPanel>
                </Grid>
            </GroupBox>
        </Grid>
        <Border CornerRadius="4" BorderThickness="0" Background="#F15045" Height="30" Margin="0,0,0,15"
                VerticalAlignment="Bottom"
                Style="{DynamicResource ErrorPlateStyle}"
                Visibility="{Binding Error, Converter={StaticResource ObjectToVisibilityConverter}}"
                HorizontalAlignment="Center">
            <Label HorizontalContentAlignment="Center" Foreground="White" Style="{DynamicResource PrimaryText}"
                   FontSize="14"
                   Content="{Binding Error.Message}" Margin="10,0,10,0" />
        </Border>
    </Grid>
</Page>